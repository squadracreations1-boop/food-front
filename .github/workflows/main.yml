name: Single 13-Minute Ping Session

on:
  schedule:
    - cron: '0 */1 * * *'  # Every 2 hours
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ”„ Single 13-Minute Session
      run: |
        echo "â–¶ï¸  Starting 13-minute session at: $(date)"
        echo "This is a SINGLE session that lasts 13 minutes"
        
        # Start time
        START=$(date +%s)
        
        # Make initial request
        echo "ðŸŒ Making initial request..."
        curl -s "https://maitreyi-foods.onrender.com" > /dev/null 2>&1 && echo "âœ… Initial connection successful"
        
        # Keep-alive loop - just wait for 13 minutes
        # This creates one session that lasts 13 minutes
        for i in {1..78}; do  # 78 * 10 seconds = 780 seconds (13 minutes)
          # Show progress every minute
          if [ $((i % 6)) -eq 0 ]; then
            elapsed=$((i * 10 / 60))
            echo "â±ï¸  Session active for ${elapsed} minutes..."
          fi
          
          # Wait 10 seconds
          sleep 10
        done
        
        echo ""
        echo "âœ… SESSION COMPLETE"
        echo "Started: $(date -d @$START)"
        echo "Ended: $(date)"
        echo "Duration: 13 minutes (single session)"
        
        # Final request to confirm
        echo "ðŸŒ Making final request..."
        curl -s "https://maitreyi-foods.onrender.com" > /dev/null 2>&1 && echo "âœ… Final connection successful"
